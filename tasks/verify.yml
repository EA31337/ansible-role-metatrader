---
- name: Verifies platform files exist
  tags:
    - metatrader_verify
  block:
    - name: Checks if platform's terminal exists
      changed_when: false
      failed_when: find_mt_res.matched == 0
      ansible.builtin.find:
        paths: '{{ ansible_env.HOME }}/.wine/drive_c'
        patterns: terminal*.exe
        recurse: true
      register: find_mt_res
      when: ansible_os_family != "Windows"

    - name: Checks if platform's editor exists
      changed_when: false
      failed_when: find_mte_res.matched == 0
      ansible.builtin.find:
        paths: '{{ ansible_env.HOME }}/.wine/drive_c'
        patterns: "[mM]eta[eE]ditor*.exe"
        recurse: true
      register: find_mte_res
      when: ansible_os_family != "Windows"
- name: Stores platform paths as facts
  block:
    - name: Sets fact
      ansible.builtin.set_fact:
        metatrader: >-
          { '{{ metatrader_version | int }}': {'path': '{{ find_mt_res.files[0].path | dirname }}'}}
      when:
        - find_mt_res is defined
        - find_mt_res.files | length > 0
        - metatrader_version is defined
    - name: Prints current facts
      ansible.builtin.debug:
        var: hostvars[inventory_hostname]['metatrader']
