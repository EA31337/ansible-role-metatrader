---
- name: Validates variables
  assert:
    that:
      - metatrader_setup_url | length > 0
- name: Install MetaTrader (via Winetricks)
  block:
    - name: Install verb file
      ansible.builtin.template:
        src: mt{{ metatrader_version }}_install.verb.j2
        dest: /tmp/mt{{ metatrader_version }}_install.verb
        mode: 0640
    - name: Install MetaTrader (via verb file)
      ansible.builtin.shell:
        # noqa command-instead-of-shell
        cmd: >
          DISPLAY=:0
          WINEDLLOVERRIDES="mscoree,mshtml=,winebrowser.exe="
          winetricks -q /tmp/mt{{ metatrader_version }}_install.verb
          && touch ~/.wine/.installed-mt{{ metatrader_version }}
        creates: ~/.wine/.installed-mt{{ metatrader_version }}
      args:
        executable: /bin/bash
  when: ansible_os_family != "Windows"
